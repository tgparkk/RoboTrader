# 필터 성능 비교 분석 보고서

**작성일**: 2025-11-17
**분석 기간**: 2025-09-01 ~ 2025-11-17

---

## 📊 성능 비교 요약

| 필터 버전 | 제외 조합 수 | 실제 수익 | 성능 |
|----------|--------------|-----------|------|
| **이전 필터** (백업) | 11개 | **약 100만원** | ✅ 더 좋음 |
| **새 필터** (자동생성) | 12개 | 약 84만원 | ❌ 16만원 손실 |

**결론**: 새 필터가 오히려 성능을 저하시킴 (-16%)

---

## 🔍 원인 분석

### 문제점

**과도한 필터링 (Overfitting)**
- 너무 많은 조합을 제외하면서 좋은 거래도 차단
- 특히 `강함(>6%) + 얕음(<1.5%) + 짧음(≤2)` 조합 (882건)을 제외하면서 문제 발생

### 이전 필터 vs 새 필터 차이

#### 이전 필터 (11개 - 더 보수적)
```
1. 약함(<4%) + 보통(1.5-2.5%) + 짧음(≤2)     34건 -15.38%
2. 강함(>6%) + 얕음(<1.5%) + 보통(3-4)        7건  -9.73%
3. 보통(4-6%) + 얕음(<1.5%) + 보통(3-4)      15건  -5.52%
4. 강함(>6%) + 깊음(>2.5%) + 짧음(≤2)        36건  -4.53%
5. 강함(>6%) + 보통(1.5-2.5%) + 보통(3-4)     4건  -4.00%
6. 보통(4-6%) + 깊음(>2.5%) + 보통(3-4)       1건  -2.50%
7. 약함(<4%) + 보통(1.5-2.5%) + 보통(3-4)     1건  -2.50%
8. 약함(<4%) + 보통(1.5-2.5%) + 김(>4)        4건  -1.83%
9. 강함(>6%) + 깊음(>2.5%) + 김(>4)           3건  -1.50%
10. 보통(4-6%) + 보통(1.5-2.5%) + 김(>4)      3건  -1.50%
11. 약함(<4%) + 깊음(>2.5%) + 짧음(≤2)       12건  -0.00%
```
**총 필터 대상**: 120건 (소량)

#### 새 필터 (12개 - 너무 공격적)
```
1. 강함(>6%) + 얕음(<1.5%) + 짧음(≤2)       882건 -219.14% ⚠️ 추가
2. 약함(<4%) + 보통(1.5-2.5%) + 짧음(≤2)    220건  -85.90%
3. 강함(>6%) + 얕음(<1.5%) + 보통(3-4)       60건  -68.87%
4. 강함(>6%) + 보통(1.5-2.5%) + 보통(3-4)    41건  -55.30%
5. 보통(4-6%) + 얕음(<1.5%) + 보통(3-4)     124건  -41.20% ⚠️ 추가
6. 보통(4-6%) + 깊음(>2.5%) + 김(>4)         13건  -27.00%
7. 보통(4-6%) + 깊음(>2.5%) + 보통(3-4)      14건  -17.50%
8. 약함(<4%) + 보통(1.5-2.5%) + 보통(3-4)     9건  -14.27%
9. 보통(4-6%) + 보통(1.5-2.5%) + 김(>4)      27건  -11.81%
10. 보통(4-6%) + 보통(1.5-2.5%) + 보통(3-4)   3건   -5.14%
11. 강함(>6%) + 깊음(>2.5%) + 김(>4)         13건   -3.50%
12. 약함(<4%) + 보통(1.5-2.5%) + 김(>4)      34건   -2.37%
```
**총 필터 대상**: 1,440건 (대량)

---

## ⚠️ 문제 조합 상세 분석

### 조합 1: 강함(>6%) + 얕음(<1.5%) + 짧음(≤2)
- **거래 수**: 882건 (전체의 12.2%)
- **총 손실**: -219.14%
- **승률**: 40.0%
- **문제**: 대량의 거래를 차단하면서 좋은 거래도 함께 차단됨

**이 조합의 특징**:
- 강한 상승 후 얕은 조정
- 짧은 지지 기간
- 손실률이 크지만, 일부는 큰 수익을 낸 거래일 수 있음

### 조합 5: 보통(4-6%) + 얕음(<1.5%) + 보통(3-4)
- **거래 수**: 124건
- **총 손실**: -41.20%
- **승률**: 33.9%

---

## 💡 권장 사항

### 1. 이전 필터 유지 (권장) ✅

**이유**:
- 실제 수익이 더 높음 (100만원 vs 84만원)
- 더 보수적인 접근 (120건 vs 1,440건)
- 과적합 방지

### 2. 보수적인 기준 적용

**새로운 필터 생성 기준**:
```bash
# 최소 10건 이상 & 총 손실 -5% 이상만 제외
python daily_filter_updater.py --all --min-trades 10 --min-loss -5.0 --update
```

이렇게 하면:
- **11개 조합** 제외 (이전과 유사)
- 과도한 필터링 방지
- 좋은 거래 보존

### 3. 단계적 접근

**Phase 1**: 확실한 손실 조합만 제외
- 최소 20건 이상
- 총 손실 -10% 이상
- 승률 30% 이하

**Phase 2**: 효과 검증 후 점진적 확대
- 1주일 후 실제 수익 비교
- 효과가 좋으면 기준 완화

---

## 📋 실행 계획

### Step 1: 이전 필터 복원 ✅ (이미 완료)
```bash
cp core/indicators/pattern_combination_filter_backup_20251117_193428.py \
   core/indicators/pattern_combination_filter.py
```

### Step 2: 보수적 기준으로 재분석
```bash
python daily_filter_updater.py --all --min-trades 10 --min-loss -5.0
```

### Step 3: 결과 확인 후 선택적 업데이트
```bash
# 만족스러우면
python daily_filter_updater.py --all --min-trades 10 --min-loss -5.0 --update
```

### Step 4: 1주일 후 효과 검증
```bash
# 다음 주에 실제 수익 비교
python daily_filter_updater.py --start 20251118 --end 20251124
```

---

## 📊 데이터 분석 인사이트

### 거래량 기준 분석

| 조합 | 거래 수 | 승률 | 총 손실/수익 | 평균 손익 |
|------|---------|------|--------------|-----------|
| 강함+얕음+짧음 | 882건 | 40.0% | -219.14% | -0.25% |
| 약함+얕음+짧음 | 2,023건 | 53.0% | +682.78% | +0.34% |

**결론**:
- 같은 "짧음" 지지라도 상승강도에 따라 결과가 극명히 다름
- 단순히 손실이 크다고 제외하면 안 됨
- 거래 수, 승률, 평균 손익을 종합 고려해야 함

### 승률 vs 총 손익

높은 손실이지만 승률이 40%인 조합을 제외하는 것이 옳은가?
- **40% 승률 = 10건 중 4건은 수익**
- 일부는 큰 수익을 냈을 가능성
- 전체를 차단하면 이익도 손실

---

## 🎯 결론

### 현재 상태
✅ **이전 필터로 롤백 완료**
✅ **보수적 기준(최소 10건, -5%)으로 재분석 완료**

### 다음 단계
1. **현재**: 이전 필터 유지 (100만원 수익)
2. **모니터링**: 1주일 동안 실제 거래 관찰
3. **재평가**: 데이터 추가 누적 후 재분석
4. **점진적 개선**: 확실한 손실 조합만 추가 제외

### 교훈
- ❌ 데이터만 보고 무조건 제외 → 과적합
- ✅ 실제 수익으로 검증 → 실용적 최적화
- ✅ 보수적 접근 → 안정적 수익

---

**작성**: 2025-11-17 20:35
**필터 상태**: 이전 필터 (11개 조합 제외)
**권장 조치**: 현 상태 유지, 1주일 후 재평가
