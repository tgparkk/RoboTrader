# 매매 성과 개선 분석 보고서
**분석 기간**: 2025.09.01 ~ 2025.10.02

---

## 📊 현재 성과 요약

### 전체 통계
- **총 거래**: 334개 (12시 이전)
- **승률**: 50.0% (167승 167패)
- **총 수익률**: +119.79%
- **실제 수익금**: +167만원 (거래당 평균 5,000원)

### 시간대별 성과
| 시간 | 거래수 | 승률 |
|-----|-------|------|
| 09시 | 86 | **55.8%** ⭐ |
| 10시 | 172 | 47.7% |
| 11시 | 76 | 48.7% |

---

## 🔍 핵심 발견사항

### 1. 패배 매매의 가장 큰 원인: **거래량 추세**

#### 승리 vs 패배 비교 (254개 거래 분석)

| 지표 | 승리 거래 | 패배 거래 | 차이 |
|------|----------|----------|------|
| **거래량 추세** | **+195.6%** | **-16.6%** | **+212%** ⭐⭐⭐ |
| RSI | 60.2 | 56.5 | +3.7 |
| 가격 변화율 | 2.68% | 2.31% | +0.38% |
| 이등분선 위치 | 1.07% | 0.88% | +0.20% |

**결론**: 승리하는 거래는 매수 시점에 거래량이 **평균 대비 2배 증가**하고 있었고,
패배하는 거래는 거래량이 **오히려 감소**하는 시점에 매수했습니다!

이는 CLAUDE.md의 눌림목 패턴과 정확히 일치:
> "급감되었던 거래량이 조금씩 증가하며 봉의 크기가 서서히 커진다 -> 매수"

**현재 문제**: 거래량이 증가하지 않는 시점에도 매수 신호를 발생시키고 있음

---

### 2. 패배 거래의 위험 신호 (하위 25% 기준)

매수 시점에 다음 조건 중 하나라도 해당되면 패배 확률 높음:

1. **거래량 급감비 < 0.22**: 최근 거래량이 평균의 22% 이하
2. **이등분선 위치 < -0.11%**: 현재가가 이등분선 아래 -0.11% 이하
3. **상승 캔들 비율 < 0.40**: 최근 5개 봉 중 상승 캔들이 40% 미만

---

### 3. 놓친 승리 기회: **541개!**

#### 전체 기회 분석 (951개 종목-날짜)
- **3% 이상 수익 가능**: 787개 (82.8%)
- **5% 이상 수익 가능**: 556개 (58.5%)
- **실제 매수한 것**: 247개 (26.0%)
- **놓친 기회 (3% 이상)**: **541개 (56.9%)** ⚠️

#### 실제 매수한 종목의 성과
- **평균 최대 수익률**: 12.22%
- **중간값**: 9.99%
- **3% 이상 달성**: 246개 (99.6%) ✅

#### 놓친 기회의 잠재 수익
- **평균 최대 수익률**: 7.96%
- **중간값**: 5.94%
- **5% 이상 가능**: 330개 (61.0%)

#### 놓친 큰 기회 Top 10
1. 249420 (20250929): +42.21%
2. 051780 (20250924): +30.65%
3. 177350 (20250910): +30.27%
4. 108490 (20250919): +30.03%
5. 025620 (20251002): +29.96%
6. 023790 (20250905): +29.90%
7. 003535 (20251001): +28.04%
8. 025550 (20250909): +26.62%
9. 030530 (20250909): +26.44%
10. 003535 (20251002): +26.22%

---

## 💡 개선 제안사항

### 제안 1: **거래량 증가 필터 추가** (최우선) ⭐⭐⭐

**현재 문제**:
- 거래량이 감소하는 시점에도 매수 신호 발생
- 패배 거래의 거래량 추세: -16.6%

**개선 방안**:
```python
# simple_pattern_filter.py 또는 pullback_candle_pattern.py에 추가

def check_volume_trend(data_3min, min_threshold=0.0):
    """
    거래량 증가 추세 확인

    Args:
        data_3min: 3분봉 데이터
        min_threshold: 최소 거래량 증가율 (0% = 감소 차단, 50% = 1.5배 이상만 허용)

    Returns:
        (bool, str): (통과 여부, 사유)
    """
    if len(data_3min) < 15:
        return False, "데이터 부족"

    recent_data = data_3min.tail(15)

    # 최근 3개 봉의 평균 거래량
    recent_volume = recent_data['volume'].tail(3).mean()

    # 이전 12개 봉의 평균 거래량
    prev_volume = recent_data['volume'].head(12).mean()

    if prev_volume == 0:
        return False, "이전 거래량 0"

    # 거래량 증가율 계산
    volume_increase = (recent_volume - prev_volume) / prev_volume * 100

    if volume_increase < min_threshold:
        return False, f"거래량 증가 부족 ({volume_increase:.1f}% < {min_threshold}%)"

    return True, f"거래량 증가 확인 ({volume_increase:.1f}%)"
```

**적용 기준**:
- **보수적**: min_threshold = 50% (1.5배 이상 증가만 허용, 승률 향상 우선)
- **중도적**: min_threshold = 0% (거래량 감소만 차단, 기회 손실 최소화)
- **권장**: min_threshold = 20~30% (적절한 균형)

**기대 효과**:
- 패배 거래 30~40% 감소 예상
- 승률 50% → 55~60% 상승 예상

---

### 제안 2: **이등분선 위치 필터 강화**

**현재 문제**:
- 이등분선 아래에서도 매수 신호 발생
- 패배 거래의 25%는 이등분선 -0.11% 이하에서 매수

**개선 방안**:
```python
def check_bisector_position(data_3min, min_position=-0.1):
    """
    이등분선 위치 확인 (CLAUDE.md: "이등분선 위에서 조정")

    Args:
        min_position: 최소 이등분선 위치 (%, -0.1 = 이등분선 -0.1% 이하 차단)
    """
    recent_data = data_3min.tail(15)

    high_15 = recent_data['high'].max()
    low_15 = recent_data['low'].min()
    bisector = (high_15 + low_15) / 2
    current_price = recent_data['close'].iloc[-1]

    position = (current_price - bisector) / bisector * 100

    if position < min_position:
        return False, f"이등분선 위치 부족 ({position:.2f}% < {min_position}%)"

    return True, f"이등분선 위치 양호 ({position:.2f}%)"
```

**기대 효과**:
- 패배 거래 10~15% 추가 감소

---

### 제안 3: **상승 캔들 비율 체크**

**현재 문제**:
- 하락 캔들이 많은 구간에서도 매수
- 패배 거래의 25%는 최근 5개 봉 중 상승 캔들이 40% 미만

**개선 방안**:
```python
def check_up_candle_ratio(data_3min, min_ratio=0.4):
    """
    최근 상승 캔들 비율 확인

    Args:
        min_ratio: 최소 상승 캔들 비율 (0.4 = 40%)
    """
    recent_data = data_3min.tail(5)
    up_candles = (recent_data['close'] > recent_data['open']).sum()
    ratio = up_candles / 5

    if ratio < min_ratio:
        return False, f"상승 캔들 부족 ({ratio:.1%} < {min_ratio:.1%})"

    return True, f"상승 캔들 충분 ({ratio:.1%})"
```

**기대 효과**:
- 패배 거래 5~10% 추가 감소

---

### 제안 4: **놓친 기회 포착을 위한 조건 완화 검토**

**현재 상황**:
- 541개의 3% 이상 수익 기회를 놓침
- 이 중 330개는 5% 이상 수익 가능

**검토 사항**:
1. 현재 신뢰도 임계값이 너무 높은지 확인
2. simple_pattern_filter의 필터링이 너무 엄격한지 확인
3. 일봉 패턴 필터가 좋은 기회를 막고 있는지 확인

**분석 필요**:
- 놓친 541개 종목에 대해 왜 매수 신호가 발생하지 않았는지 로그 분석
- 각 필터별로 차단된 건수 통계 확인

---

## 🎯 실행 우선순위

### 1단계 (즉시 적용 - 승률 향상 우선)
1. **거래량 증가 필터 추가** (min_threshold = 20~30%)
2. **이등분선 위치 필터 강화** (min_position = -0.1%)

→ **예상 효과**: 승률 50% → 57~60%, 패배 거래 40% 감소

### 2단계 (검증 후 적용)
3. **상승 캔들 비율 체크** (min_ratio = 0.4)
4. **놓친 기회 분석** 및 조건 완화 검토

→ **예상 효과**: 승률 60% → 65%, 거래 기회 20~30% 증가

---

## 📈 예상 개선 효과

### 현재 (2025.09.01~10.02)
- 총 거래: 334개
- 승률: 50.0%
- 총 수익: +167만원

### 1단계 적용 후 (예상)
- 총 거래: 250~280개 (패배 거래 차단으로 감소)
- 승률: 57~60%
- 총 수익: +200~250만원 (+20~50% 증가)

### 2단계 적용 후 (예상)
- 총 거래: 300~350개 (놓친 기회 일부 포착)
- 승률: 62~65%
- 총 수익: +300~400만원 (+80~140% 증가)

---

## 🔧 구현 가이드

### 파일 수정 위치
1. **core/indicators/simple_pattern_filter.py**
   - `should_filter_out()` 메서드에 거래량/이등분선/캔들 비율 필터 추가

2. **core/indicators/pullback_candle_pattern.py**
   - `generate_improved_signals()` 메서드에 거래량 증가 조건 추가

### 테스트 방법
```bash
# 백테스트로 효과 검증
python signal_replay.py 20250901 20251002

# 새로운 통계와 이전 통계 비교
# - 승률 변화
# - 패배 거래 감소율
# - 놓친 기회 감소율
```

---

## 📝 결론

**핵심 문제**: 거래량이 감소하는 시점에 매수하여 패배율 50%

**핵심 해결책**: 거래량 증가 필터 추가 (CLAUDE.md 원칙 준수)

**기대 효과**: 승률 50% → 60~65%, 수익 80~140% 증가

**다음 단계**: 1단계 필터 적용 → 백테스트 검증 → 2단계 조건 완화 검토
