# ML ëª¨ë¸ ìƒì„¸ ì •ë³´

## ğŸ“¦ íŒŒì¼ ì •ë³´
- **íŒŒì¼ëª…**: `ml_model_stratified.pkl`
- **íŒŒì¼ í¬ê¸°**: 1.29 MB (1,354,298 bytes)
- **í˜•ì‹**: Python Pickle íŒŒì¼

---

## ğŸ¤– ëª¨ë¸ êµ¬ì¡°

### 1. LightGBM Booster
- **ì•Œê³ ë¦¬ì¦˜**: Gradient Boosting Decision Tree (GBDT)
- **íŠ¸ë¦¬ ê°œìˆ˜**: 999ê°œ
- **íŠ¹ì„± ê°œìˆ˜**: 26ê°œ
- **ëª©ì **: Binary Classification (ìŠ¹/íŒ¨ ì˜ˆì¸¡)
- **í‰ê°€ ì§€í‘œ**: AUC (Area Under ROC Curve)

### 2. í•˜ì´í¼íŒŒë¼ë¯¸í„°

#### í•™ìŠµ íŒŒë¼ë¯¸í„°
```
learning_rate: 0.01          # ë‚®ì€ í•™ìŠµë¥ ë¡œ ì•ˆì •ì  í•™ìŠµ
num_iterations: 1000         # ìµœëŒ€ 1000ë²ˆ ë°˜ë³µ
num_leaves: 15               # ê° íŠ¸ë¦¬ì˜ ìµœëŒ€ ë¦¬í”„ ë…¸ë“œ ìˆ˜
max_depth: 4                 # íŠ¸ë¦¬ ìµœëŒ€ ê¹Šì´ (ê³¼ì í•© ë°©ì§€)
min_data_in_leaf: 50         # ë¦¬í”„ ë…¸ë“œ ìµœì†Œ ë°ì´í„° ìˆ˜
```

#### ê³¼ì í•© ë°©ì§€
```
feature_fraction: 0.6        # ê° íŠ¸ë¦¬ì—ì„œ 60%ì˜ íŠ¹ì„±ë§Œ ì‚¬ìš©
bagging_fraction: 0.6        # ê° ë°˜ë³µì—ì„œ 60%ì˜ ë°ì´í„°ë§Œ ì‚¬ìš©
bagging_freq: 5              # 5ë²ˆë§ˆë‹¤ ë°°ê¹… ìˆ˜í–‰
lambda_l1: 1.0               # L1 ì •ê·œí™” (Lasso)
lambda_l2: 1.0               # L2 ì •ê·œí™” (Ridge)
```

#### ê¸°íƒ€
```
objective: binary            # ì´ì§„ ë¶„ë¥˜
metric: auc                  # AUC ìµœì í™”
seed: 42                     # ì¬í˜„ì„±ì„ ìœ„í•œ ëœë¤ ì‹œë“œ
```

---

## ğŸ“Š 26ê°œ ì…ë ¥ íŠ¹ì„±

### ì‹œê°„ íŠ¹ì„± (4ê°œ)
1. `hour` - ì‹œê°„ (0-23)
2. `minute` - ë¶„ (0-59)
3. `time_in_minutes` - ì´ ë¶„ (0-1439)
4. `is_morning` - ì˜¤ì „ ì—¬ë¶€ (0/1)

### ì‹ í˜¸ íŠ¹ì„± (2ê°œ)
5. `signal_type` - ì‹ í˜¸ íƒ€ì… (STRONG_BUY=1, ê¸°íƒ€=0)
6. `confidence` - ì‹ í˜¸ ì‹ ë¢°ë„ (0-100)

### ìƒìŠ¹ êµ¬ê°„ íŠ¹ì„± (5ê°œ)
7. `uptrend_candles` - ìƒìŠ¹ êµ¬ê°„ ìº”ë“¤ ìˆ˜
8. `uptrend_gain` - ìƒìŠ¹ë¥  (%)
9. `uptrend_max_volume` - ìµœëŒ€ ê±°ë˜ëŸ‰ (ê¸°ì¤€ê±°ë˜ëŸ‰)
10. `uptrend_avg_body` - í‰ê·  ëª¸í†µ í¬ê¸° (%)
11. `uptrend_total_volume` - ì´ ê±°ë˜ëŸ‰

### í•˜ë½ êµ¬ê°„ íŠ¹ì„± (3ê°œ)
12. `decline_candles` - í•˜ë½ êµ¬ê°„ ìº”ë“¤ ìˆ˜
13. `decline_pct` - í•˜ë½ë¥  (%)
14. `decline_avg_volume` - í‰ê·  ê±°ë˜ëŸ‰

### ì§€ì§€ êµ¬ê°„ íŠ¹ì„± (4ê°œ)
15. `support_candles` - ì§€ì§€ êµ¬ê°„ ìº”ë“¤ ìˆ˜
16. `support_volatility` - ê°€ê²© ë³€ë™ì„±
17. `support_avg_volume_ratio` - í‰ê·  ê±°ë˜ëŸ‰ ë¹„ìœ¨
18. `support_avg_volume` - í‰ê·  ê±°ë˜ëŸ‰

### ëŒíŒŒ êµ¬ê°„ íŠ¹ì„± (3ê°œ)
19. `breakout_volume` - ëŒíŒŒ ìº”ë“¤ ê±°ë˜ëŸ‰
20. `breakout_body` - ëŒíŒŒ ìº”ë“¤ ëª¸í†µ í¬ê¸° (%)
21. `breakout_range` - ëŒíŒŒ ìº”ë“¤ ë²”ìœ„ (%)

### ë¹„ìœ¨ íŠ¹ì„± (5ê°œ)
22. `volume_ratio_decline_to_uptrend` - í•˜ë½/ìƒìŠ¹ ê±°ë˜ëŸ‰ ë¹„ìœ¨
23. `volume_ratio_support_to_uptrend` - ì§€ì§€/ìƒìŠ¹ ê±°ë˜ëŸ‰ ë¹„ìœ¨
24. `volume_ratio_breakout_to_uptrend` - ëŒíŒŒ/ìƒìŠ¹ ê±°ë˜ëŸ‰ ë¹„ìœ¨
25. `price_gain_to_decline_ratio` - ìƒìŠ¹/í•˜ë½ ë¹„ìœ¨
26. `candle_ratio_support_to_decline` - ì§€ì§€/í•˜ë½ ìº”ë“¤ ìˆ˜ ë¹„ìœ¨

---

## ğŸ¯ íŠ¹ì„± ì¤‘ìš”ë„ (Top 10)

ëª¨ë¸ì´ ìŠ¹ë¥  ì˜ˆì¸¡ì— ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ì‚¬ìš©í•˜ëŠ” íŠ¹ì„±:

1. **decline_avg_volume** (16,144) - í•˜ë½ êµ¬ê°„ í‰ê·  ê±°ë˜ëŸ‰
2. **decline_pct** (14,091) - í•˜ë½ë¥ 
3. **volume_ratio_breakout_to_uptrend** (13,541) - ëŒíŒŒ/ìƒìŠ¹ ê±°ë˜ëŸ‰ ë¹„ìœ¨
4. **uptrend_gain** (12,701) - ìƒìŠ¹ë¥ 
5. **support_avg_volume_ratio** (12,239) - ì§€ì§€ êµ¬ê°„ ê±°ë˜ëŸ‰ ë¹„ìœ¨
6. **price_gain_to_decline_ratio** (10,464) - ìƒìŠ¹/í•˜ë½ ë¹„ìœ¨
7. **uptrend_max_volume** (10,355) - ê¸°ì¤€ê±°ë˜ëŸ‰
8. **uptrend_avg_body** (10,214) - ìƒìŠ¹ êµ¬ê°„ í‰ê·  ëª¸í†µ í¬ê¸°
9. **uptrend_total_volume** (9,982) - ìƒìŠ¹ êµ¬ê°„ ì´ ê±°ë˜ëŸ‰
10. **volume_ratio_decline_to_uptrend** (9,546) - í•˜ë½/ìƒìŠ¹ ê±°ë˜ëŸ‰ ë¹„ìœ¨

**í•µì‹¬ ì¸ì‚¬ì´íŠ¸**:
- í•˜ë½ êµ¬ê°„ì˜ ê±°ë˜ëŸ‰ê³¼ í•˜ë½ë¥ ì´ ê°€ì¥ ì¤‘ìš”
- ê±°ë˜ëŸ‰ ë¹„ìœ¨ íŠ¹ì„±ë“¤ì´ ë†’ì€ ì¤‘ìš”ë„ë¥¼ ë³´ì„
- ìƒìŠ¹ êµ¬ê°„ì˜ ê°•ë„(gain, volume)ë„ ì¤‘ìš”í•œ íŒë‹¨ ê¸°ì¤€

---

## ğŸ“ˆ ëª¨ë¸ ì„±ëŠ¥

### êµì°¨ ê²€ì¦ ê²°ê³¼ (5-Fold Stratified)
```
Fold 1: 0.9680 (96.80%)
Fold 2: 0.9614 (96.14%)
Fold 3: 0.9684 (96.84%)
Fold 4: 0.9632 (96.32%)
Fold 5: 0.9670 (96.70%)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
í‰ê·  AUC: 0.9656 (96.56%)
```

**ì„±ëŠ¥ í•´ì„**:
- AUC 96.56%ëŠ” ë§¤ìš° ìš°ìˆ˜í•œ ì„±ëŠ¥
- 5ê°œ í´ë“œ ê°„ ì¼ê´€ì„± ìˆëŠ” ì„±ëŠ¥ (96.14% ~ 96.84%)
- ê³¼ì í•© ì—†ì´ ì•ˆì •ì ìœ¼ë¡œ í•™ìŠµë¨

---

## ğŸ”§ ëª¨ë¸ ì‚¬ìš© ë°©ë²•

### 1. ëª¨ë¸ ë¡œë“œ
```python
from core.ml_predictor import MLPredictor

predictor = MLPredictor()
predictor.load_model()  # ml_model_stratified.pkl ë¡œë“œ
```

### 2. ìŠ¹ë¥  ì˜ˆì¸¡
```python
pattern_data = {
    'signal_time': '2025-11-22 10:30:00',
    'signal_info': {'signal_type': 'STRONG_BUY', 'confidence': 85},
    'debug_info': {
        'uptrend': {...},
        'decline': {...},
        'support': {...},
        'breakout': {...}
    }
}

should_trade, win_prob = predictor.should_trade(
    pattern_data,
    threshold=0.5  # 50% ì´ìƒë§Œ ê±°ë˜
)

print(f"ìŠ¹ë¥ : {win_prob:.1%}")
print(f"ê±°ë˜ í—ˆìš©: {should_trade}")
```

### 3. íŠ¹ì„± ì¶”ì¶œ
```python
features_df = predictor.extract_features_from_pattern(pattern_data)
# 26ê°œ íŠ¹ì„±ì´ ì¶”ì¶œë˜ì–´ DataFrameìœ¼ë¡œ ë°˜í™˜ë¨
```

---

## ğŸ“¦ íŒŒì¼ ë‚´ìš©

`ml_model_stratified.pkl` íŒŒì¼ì— í¬í•¨ëœ ë‚´ìš©:

```python
{
    'model': <LightGBM Booster>,           # í•™ìŠµëœ ëª¨ë¸
    'label_encoder': <LabelEncoder>,       # ë¼ë²¨ ì¸ì½”ë”
    'feature_names': [26ê°œ íŠ¹ì„± ì´ë¦„],      # íŠ¹ì„± ì´ë¦„ ë¦¬ìŠ¤íŠ¸
    'cv_scores': [5ê°œ í´ë“œ ì ìˆ˜],           # êµì°¨ ê²€ì¦ ì ìˆ˜
    'version': 'stratified',               # ëª¨ë¸ ë²„ì „
    'description': 'LightGBM with ...'     # ì„¤ëª…
}
```

---

## âš™ï¸ í•™ìŠµ ë°©ì‹

1. **Stratified K-Fold (5-Fold)**
   - ë°ì´í„°ë¥¼ 5ê°œ í´ë“œë¡œ ë¶„í• 
   - ê° í´ë“œì—ì„œ ìŠ¹/íŒ¨ ë¹„ìœ¨ ìœ ì§€
   - 5ë²ˆ í•™ìŠµí•˜ì—¬ í‰ê·  ì„±ëŠ¥ ì¸¡ì •

2. **ê³¼ì í•© ë°©ì§€ ê¸°ë²•**
   - Feature/Bagging Fraction (60%)
   - L1/L2 ì •ê·œí™”
   - ìµœëŒ€ ê¹Šì´ ì œí•œ (4)
   - ì ì€ ë¦¬í”„ ë…¸ë“œ (15ê°œ)
   - ë‚®ì€ í•™ìŠµë¥  (0.01)

3. **Early Stopping**
   - ìµœëŒ€ 1000ë²ˆ ë°˜ë³µ
   - ì„±ëŠ¥ ê°œì„  ì—†ìœ¼ë©´ ì¡°ê¸° ì¢…ë£Œ
   - ìµœì¢… 999ê°œ íŠ¸ë¦¬ ìƒì„±

---

## ğŸ¯ ëª¨ë¸ ë²„ì „

- **Version**: `stratified`
- **Description**: LightGBM with Stratified K-Fold and overfitting prevention
- **Label**: STRONG_BUY ì‹ í˜¸ë§Œ í•™ìŠµ (ìŠ¹/íŒ¨ ë¶„ë¥˜)

---

## ğŸ“ ìš”ì•½

ì´ ML ëª¨ë¸ì€:
- âœ… 4ë‹¨ê³„ íŒ¨í„´ì˜ 26ê°œ íŠ¹ì„±ì„ ì…ë ¥ë°›ì•„
- âœ… í•´ë‹¹ íŒ¨í„´ì˜ ìŠ¹ë¥ ì„ 0~100% ë²”ìœ„ë¡œ ì˜ˆì¸¡
- âœ… 96.56% AUCì˜ ë†’ì€ ì •í™•ë„
- âœ… ê³¼ì í•© ì—†ì´ ì•ˆì •ì ìœ¼ë¡œ í•™ìŠµë¨
- âœ… ì‹¤ì‹œê°„/ì‹œë®¬ë ˆì´ì…˜ ëª¨ë‘ì—ì„œ ë™ì¼í•˜ê²Œ ì‘ë™

**í•µì‹¬**: í•˜ë½ êµ¬ê°„ì˜ ê±°ë˜ëŸ‰ê³¼ ë¹„ìœ¨ì´ ìŠ¹ë¥  ì˜ˆì¸¡ì— ê°€ì¥ ì¤‘ìš”í•œ ì§€í‘œ!
