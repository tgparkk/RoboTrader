# ì¼ë´‰ í•„í„° ì‹¤ì‹œê°„ ë™ì‘ ì ê²€ ìš”ì•½

## ê²°ë¡ 
âœ… **ê¸°ë³¸ êµ¬ì¡°ëŠ” ì™„ë²½í•˜ê²Œ ì‘ë™** - ë‹¨, 1ê°€ì§€ ê°œì„  í•„ìš”

---

## í˜„ì¬ ìƒíƒœ

### âœ… ì •ìƒ ì‘ë™í•˜ëŠ” ê²ƒë“¤

1. **ë°ì´í„° íë¦„**
   - signal_time â†’ trade_date ë³€í™˜ âœ…
   - trade_date â†’ advanced_filter ì „ë‹¬ âœ…
   - DailyDataCache ì¡°íšŒ âœ…
   - ì¼ë´‰ íŠ¹ì§• ì¶”ì¶œ âœ…
   - 4ê°œ í•„í„° ì ìš© âœ…

2. **ì„±ëŠ¥**
   - DuckDB ì¡°íšŒ ì†ë„: **1ms ì´í•˜** âœ…
   - ë©”ëª¨ë¦¬ ì‚¬ìš©: **15MB ì´í•˜** âœ…
   - ë§¤ìˆ˜ ì‹ í˜¸ë‹¹ ì§€ì—°: **ê±°ì˜ ì—†ìŒ** âœ…

3. **ì•ˆì „ì„±**
   - ë°ì´í„° ì—†ì„ ë•Œ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ âœ…
   - ì£¼ë§/ê³µíœ´ì¼ ì²˜ë¦¬ âœ…
   - ì‹ ê·œ ìƒì¥ (ë°ì´í„° ë¶€ì¡±) ì²˜ë¦¬ âœ…

### ğŸ”´ ê°œì„  í•„ìš”í•œ ê²ƒ

**ì¼ë´‰ ë°ì´í„° ìë™ ìˆ˜ì§‘ ë¯¸êµ¬í˜„**

**ë¬¸ì œ:**
```
ì˜¤ëŠ˜ ì²˜ìŒ ì„ ì •ëœ ì¢…ëª©
â”œâ”€ DuckDBì— ì¼ë´‰ ë°ì´í„° ì—†ìŒ
â”œâ”€ ì¼ë´‰ í•„í„° ì „ë¶€ í†µê³¼ (ì ìš© ì•ˆ ë¨)
â””â”€ ìŠ¹ë¥  49.6% êµ¬ê°„ ê±°ë˜ (í•„í„° íš¨ê³¼ ìƒì‹¤)

ì˜ˆì „ì— ì„ ì •ëœ ì¢…ëª©
â”œâ”€ DuckDBì— ì¼ë´‰ ë°ì´í„° ìˆìŒ
â”œâ”€ ì¼ë´‰ í•„í„° ì •ìƒ ì ìš©
â””â”€ ìŠ¹ë¥  52.7% êµ¬ê°„ ê±°ë˜ (í•„í„° íš¨ê³¼ ìˆìŒ)
```

**ì˜í–¥ë„:**
- ì‹ ê·œ ì¢…ëª© ë¹„ìœ¨ì´ ë†’ìœ¼ë©´ â†’ í•„í„° íš¨ê³¼ ê°ì†Œ
- ê¸°ì¡´ ì¢…ëª© ìœ„ì£¼ë©´ â†’ ë¬¸ì œ ì—†ìŒ

---

## í•´ê²° ë°©ë²• (ê°„ë‹¨)

### ì œê³µëœ íŒŒì¼

1. **utils/daily_data_helper.py** - ìë™ ìˆ˜ì§‘ í—¬í¼
2. **test_daily_data_helper.py** - í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
3. **docs/daily_filter_realtime_check.md** - ìƒì„¸ ì ê²€ ë³´ê³ ì„œ
4. **docs/daily_filter_integration_guide.md** - í†µí•© ê°€ì´ë“œ

### ì ìš© ë°©ë²• (ì„ íƒ)

#### ë°©ë²• 1: ê°€ì¥ ê°„ë‹¨ (ì¶”ì²œ)

**core/candidate_selector.py** ìˆ˜ì •:

```python
async def select_candidates(self):
    # ê¸°ì¡´ ì„ ì • ë¡œì§
    selected = [...]

    # ğŸ†• ì¶”ê°€: ì¼ë´‰ ë°ì´í„° í™•ë³´ (3ì¤„)
    from utils.daily_data_helper import ensure_daily_data_for_stock
    for stock in selected:
        ensure_daily_data_for_stock(stock.code)

    return selected
```

#### ë°©ë²• 2: ì¥ ì‹œì‘ ì „ ì¼ê´„ ìˆ˜ì§‘

**main.py** ìˆ˜ì •:

```python
async def pre_market_routine():
    """ì¥ ì‹œì‘ ì „ ë£¨í‹´ (08:30)"""
    from utils.daily_data_helper import check_daily_data_coverage
    import sqlite3

    # ìµœê·¼ 7ì¼ ì¢…ëª© ì¡°íšŒ
    conn = sqlite3.connect('data/robotrader.db')
    stocks = conn.execute("""
        SELECT DISTINCT stock_code
        FROM candidate_stocks
        WHERE selection_date >= date('now', '-7 days')
    """).fetchall()
    conn.close()

    # ì»¤ë²„ë¦¬ì§€ í™•ì¸ ë° ìˆ˜ì§‘
    coverage = check_daily_data_coverage([s[0] for s in stocks])
    print(f"ì¼ë´‰ ë°ì´í„°: {coverage['with_data']}/{coverage['total']} ìµœì‹ ")
```

---

## ê²€ì¦ ë°©ë²•

### 1. í—¬í¼ í…ŒìŠ¤íŠ¸
```bash
python test_daily_data_helper.py
```

**ì˜ˆìƒ ì¶œë ¥:**
```
âœ… ì¼ë´‰ ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ: 005930 (30ì¼)
ğŸ“Š ì»¤ë²„ë¦¬ì§€: 12/15 ìµœì‹  (80.0%)
```

### 2. í•„í„° ë™ì‘ í™•ì¸
```bash
python test_daily_filter.py
```

**ì˜ˆìƒ ì¶œë ¥:**
```
í˜„ì¬ í™œì„± í”„ë¦¬ì…‹: volume_surge
í™œì„±í™”ëœ í•„í„°: ..., ì¼ë´‰ê±°ë˜ëŸ‰
âœ… ì‹ í˜¸ í†µê³¼ (ë˜ëŠ” âŒ ì‹ í˜¸ ì°¨ë‹¨: daily_volume_ratio)
```

### 3. ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸
```bash
tail -f logs/trading_*.log | grep "ì¼ë´‰\|ê³ ê¸‰ í•„í„°"
```

**ì˜ˆìƒ ì¶œë ¥:**
```
[09:05] âœ… ì¼ë´‰ ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ: 005930 (28ì¼)
[09:12] ğŸ”° 005930 ê³ ê¸‰ í•„í„° ì°¨ë‹¨: daily_volume_ratio - 1.20x < 1.50x
```

---

## í†µí•© ê²°ì •

### ì§€ê¸ˆ ë‹¹ì¥ ì ìš© ì•ˆ í•´ë„ ë˜ëŠ” ê²½ìš°

- ëŒ€ë¶€ë¶„ ì¢…ëª©ì´ **ë°˜ë³µ ì„ ì •**ë˜ëŠ” ê²½ìš°
- ì´ë¯¸ `scripts/collect_daily_for_analysis.py` ì‹¤í–‰í–ˆê³ , ì‹ ê·œ ì¢…ëª©ì´ ë“œë¬¸ ê²½ìš°
- ì¼ë‹¨ í…ŒìŠ¤íŠ¸ë¡œ ëŒë ¤ë³´ê³  ì‹¶ì€ ê²½ìš°

### ì ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš°

- ë§¤ì¼ **ìƒˆë¡œìš´ ì¢…ëª©**ì´ ë§ì´ ì„ ì •ë˜ëŠ” ê²½ìš°
- ì¼ë´‰ í•„í„° íš¨ê³¼ë¥¼ **100% ë³´ì¥**í•˜ê³  ì‹¶ì€ ê²½ìš°
- ì‹¤ê±°ë˜ì—ì„œ **ìŠ¹ë¥  52.7%ë¥¼ í™•ì‹¤íˆ** ë‹¬ì„±í•˜ê³  ì‹¶ì€ ê²½ìš°

---

## ì¶”ê°€ ê¸°ëŠ¥ (ì„ íƒ)

### ì¼ë´‰ ë°ì´í„° ëª¨ë‹ˆí„°ë§

```bash
# ë§¤ì¼ ì¥ ì‹œì‘ ì „ ì‹¤í–‰
python -c "
from utils.daily_data_helper import check_daily_data_coverage
import sqlite3

conn = sqlite3.connect('data/robotrader.db')
stocks = conn.execute('''
    SELECT DISTINCT stock_code
    FROM candidate_stocks
    WHERE selection_date >= date('now', '-7 days')
''').fetchall()

coverage = check_daily_data_coverage([s[0] for s in stocks])
print(f'ì¼ë´‰ ì»¤ë²„ë¦¬ì§€: {coverage[\"with_data\"]}/{coverage[\"total\"]}')
print(f'ìˆ˜ì§‘ í•„ìš”: {coverage[\"without_data\"]}ê°œ')
"
```

---

## FAQ

### Q: ì§€ê¸ˆ ë°”ë¡œ ì ìš© ì•ˆ í•˜ë©´ ë¬¸ì œ ìˆë‚˜ìš”?
A: ì•„ë‹ˆìš”. ì´ë¯¸ ìˆ˜ì§‘ëœ ì¢…ëª©ì€ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤. ë‹¤ë§Œ **ì‹ ê·œ ì¢…ëª©**ì— ëŒ€í•´ì„œë§Œ í•„í„°ê°€ ì•ˆ ë¨¹í™ë‹ˆë‹¤.

### Q: ì„±ëŠ¥ ì˜í–¥ì€ ì—†ë‚˜ìš”?
A: ê±°ì˜ ì—†ìŠµë‹ˆë‹¤.
- ì¢…ëª©ë‹¹ +0.1ì´ˆ (ì´ë¯¸ ë°ì´í„° ìˆìœ¼ë©´ ì¦‰ì‹œ ìŠ¤í‚µ)
- ë§¤ìˆ˜ ì‹ í˜¸ëŠ” ë³€í™” ì—†ìŒ (DuckDB 1ms)

### Q: ê¸°ì¡´ ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼ëŠ” ìœ íš¨í•œê°€ìš”?
A: ë„¤. ì‹œë®¬ë ˆì´ì…˜ì€ ì´ë¯¸ ìˆ˜ì§‘ëœ ë°ì´í„° ê¸°ë°˜ì´ë¯€ë¡œ 100% ìœ íš¨í•©ë‹ˆë‹¤.

### Q: í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ë¨¼ì € ëŒë ¤ë³¼ ìˆ˜ ìˆë‚˜ìš”?
A: ë„¤. `test_daily_data_helper.py`ë¡œ ì•ˆì „í•˜ê²Œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

## ìš”ì•½

| í•­ëª© | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| ë°ì´í„° íë¦„ | âœ… ì™„ë²½ | signal_time â†’ trade_date â†’ í•„í„° |
| DuckDB ì„±ëŠ¥ | âœ… ì™„ë²½ | 1ms ì´í•˜ |
| ì•ˆì „ì„± | âœ… ì™„ë²½ | ì—£ì§€ ì¼€ì´ìŠ¤ ì²˜ë¦¬ |
| ì¼ë´‰ ë°ì´í„° ìˆ˜ì§‘ | ğŸ”´ ìˆ˜ë™ | ìë™í™” ê¶Œì¥ (ì„ íƒ) |

**ê²°ë¡ :** í˜„ì¬ë„ ì‘ë™í•˜ì§€ë§Œ, ì‹ ê·œ ì¢…ëª© ëŒ€ì‘ì„ ìœ„í•´ ìë™ ìˆ˜ì§‘ ì¶”ê°€ ê¶Œì¥

---

## ë‹¤ìŒ ë‹¨ê³„

### ì„ íƒ 1: ì§€ê¸ˆ ë‹¹ì¥ ì ìš©
```bash
# 1. í…ŒìŠ¤íŠ¸
python test_daily_data_helper.py

# 2. candidate_selector.py ìˆ˜ì • (3ì¤„ ì¶”ê°€)

# 3. ì‹¤ê±°ë˜ ì ìš©
```

### ì„ íƒ 2: ë‚˜ì¤‘ì— ì ìš©
```bash
# í•„ìš”í•  ë•Œ docs/daily_filter_integration_guide.md ì°¸ì¡°
```

### ì„ íƒ 3: í˜„ì¬ ìƒíƒœ ìœ ì§€
```bash
# ì£¼ê¸°ì ìœ¼ë¡œ ìˆ˜ë™ ìˆ˜ì§‘
python scripts/collect_daily_for_analysis.py
```
